<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Zamonaviy Navbat Tizimi</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; }
    nav { padding:10px; background:#eee; }
    nav button { margin-right:10px; padding:8px 15px; }
    .section { display:none; padding:20px; }
    .active { display:block; }
    .queue-number { font-size:2em; margin:20px 0; text-align:center; }
    button { padding:10px 20px; margin:10px; }
    ul { list-style:none; padding:0; }
    li { padding:5px; border-bottom:1px solid #eee; }

    /* Monitor dizayni */
    #monitor {
      background:#000;
      color:#0f0;
      text-align:center;
      height:100vh;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
    }
    #monitor h2 { font-size:3em; margin-bottom:20px; }
    #current-call {
      font-size:8em;
      font-weight:bold;
      color:#0f0;
    }
  </style>
</head>
<body>

<nav>
  <button onclick="showSection('ticket')">Navbat olish</button>
  <button onclick="showSection('operator')">Operator</button>
  <button onclick="showSection('monitor')">Monitor</button>
</nav>

<!-- Navbat olish bo‘limi -->
<div id="ticket" class="section active">
  <h2>Navbat olish</h2>
  <button onclick="takeTicket()">Navbat olish</button>
  <div id="my-ticket" class="queue-number">Sizda navbat yo‘q</div>
</div>

<!-- Operator bo‘limi -->
<div id="operator" class="section">
  <h2>Operator</h2>
  <button onclick="callNext()">Keyingi navbatni chaqirish</button>
  <div id="operator-call" class="queue-number">Hozircha chaqirilmagan</div>
</div>

<!-- Monitor bo‘limi -->
<div id="monitor" class="section">
  <h2>MONITOR</h2>
  <div id="current-call">---</div>
  <div id="time" style="color:#fff; font-size:2em; margin-top:20px;"></div>
</div>

<script>
  let queue = [];
  let ticketCounter = 0;
  const channel = new BroadcastChannel("queueChannel");

  function showSection(id) {
    document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function takeTicket() {
    ticketCounter++;
    const ticket = "S" + ticketCounter;
    queue.push(ticket);
    document.getElementById("my-ticket").innerText = "Sizning navbat: " + ticket;
    channel.postMessage({type:"update", queue});
  }

  function callNext() {
    if (queue.length > 0) {
      const next = queue.shift();
      document.getElementById("operator-call").innerText = "Operator chaqirdi: " + next;
      document.getElementById("current-call").innerText = next;
      channel.postMessage({type:"call", current: next, queue});
    } else {
      document.getElementById("operator-call").innerText = "Navbat yo‘q";
      document.getElementById("current-call").innerText = "---";
      channel.postMessage({type:"call", current: null, queue});
    }
  }

  // Monitor real vaqt soat
  function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString();
    document.getElementById("time").innerText = "Vaqt: " + timeStr;
  }
  setInterval(updateTime, 1000);

  // BroadcastChannel orqali sinxronlash
  channel.onmessage = (e) => {
    if(e.data.type === "call") {
      document.getElementById("current-call").innerText = e.data.current ? e.data.current : "---";
    }
  };
</script>

</body>
</html>

